<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="/common/template :: header(~{::title},~{::link},~{::style})">
    <style>
        a{
            color: #005980;
        }
        .widget-small{
            background-color: #FFFFFF;
            overflow: hidden;
            text-align: center;
            border-radius: 2px;
            box-shadow: 0 1px 2px 0 rgba(0,0,0,.05);
        }
        .memory-unit {
            font-size: 14px; /* 自定义单位字体大小 */
            color: #000000; /* 自定义单位颜色 */
        }
        .widget-small .fa{
            float: left;
            width: 40%;
            line-height: 80px;
            color: #FFFFFF;
        }
        .widget-user .fa{
            background-color: #18a974;
        }
        .widget-visit .fa{
            background-color: #e79d4f;
        }
        .widget-message .fa{
            background-color: #17a2b8;
        }
        .widget-like .fa{
            background-color: #75878a;
        }
        .larger-bold {
            font-weight: bold;
            font-size: 18px; /* 这里可以根据需要调整字号大小 */
        }
        .widget-small-info{
            float: left;
            text-align: left;
            width: 40%;
            margin-left: 20px;
            margin-top: 18px;
            line-height: 24px;
        }
        .widget-small-info h4{
            font-size: 18px;
        }
        .widget-small-info span{
            font-size: 16px;
        }
        .project-introduce{
            min-height: 466px;
        }
        .project-introduce h4{
            font-weight: bold;
            margin-top: 12px;
            margin-bottom: 8px;
        }
        .project-introduce li{
            list-style: decimal;
            margin-left: 28px;
        }
        .alert {
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid transparent;
            border-radius: 4px;
        }
        .alert-info {
            color: #31708f;
            background-color: #d9edf7;
            border-color: #bce8f1;
        }
    </style>
</head>
<body class="timo-layout-page" th:style="'background-image: url(' + @{/images/page.png} + ')'">
<div class="layui-row layui-col-space15">
    <div class="layui-col-md3 layui-col-sm6 layui-col-xs12">
        <div class="widget-small widget-user">
            <i class="icon fa fa-cloud-upload fa-3x"></i>
            <div class="widget-small-info">
                <h4>服务总内存</h4>
                <span>253</span>
                <span class="memory-unit">MB</span>
            </div>
        </div>
    </div>
    <div class="layui-col-md3 layui-col-sm6 layui-col-xs12">
        <div class="widget-small widget-visit">
            <i class="icon fa fa-line-chart fa-3x"></i>
            <div class="widget-small-info">
                <h4>新增日志</h4>
                <span id="newLogsCount">0</span>
                <span class="memory-unit">条</span>
            </div>
        </div>
    </div>
    <div class="layui-col-md3 layui-col-sm6 layui-col-xs12">
        <div class="widget-small widget-message">
            <i class="icon fa fa-users fa-3x"></i>
            <div class="widget-small-info">
                <h4>用户数量</h4>
                <span>3</span>
            </div>
        </div>
    </div>
    <div class="layui-col-md3 layui-col-sm6 layui-col-xs12">
        <div class="widget-small widget-like">
            <i class="icon fa fa-graduation-cap fa-3x"></i>
            <div class="widget-small-info">
                <h4>系统数量</h4>
                <span>3</span>
            </div>
        </div>
    </div>
</div>
<div class="layui-row layui-col-space15">
    <div class="layui-col-md7">

        <div class="layui-card">
            <div class="layui-card-header larger-bold">内存占比</div>
            <div class="layui-card-body" style="height: 380px;">
                <div id="pieChart" style="width: 100%; height: 100%;"></div>
            </div>
        </div>

        <div class="layui-row layui-col-space15">
            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header larger-bold">系统功能</div>
                    <div class="layui-card-body">
                        <ol>
                            <li><a th:href="@{/system/sticky/index}">粘随子系统</a>：用于配置粘随子系统。</li>
                            <li><a th:href="@{/system/locking/index}">锁闭保护</a>：用于配置锁闭保护。</li>
                            <li><a th:href="@{/system/actionLog/index}">系统日志</a>：用于查看用户行为记录。</li>
                            <li><a th:href="@{/system/dept/index}">项目管理</a>：通过不同的项目来管理和区分用户。</li>
                            <li><a th:href="@{/system/user/index}">账号管理</a>：用于管理后台系统的用户。</li>
                            <li><a th:href="@{/system/menu/index}">菜单管理</a>：用于配置系统菜单。</li>
                        </ol>
                    </div>
                </div>
                <div class="layui-card">
                    <div class="layui-card-header larger-bold">帮助文档</div>
                    <div class="layui-card-body">
                        <ul>
                            <li><i class="fa fa-paper-plane"></i> 版本：v1.0.1</li>
                            <li><i class="fa fa-coffee"></i> 作者：EchoTeam</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header larger-bold">更新日志</div>
                    <div class="layui-card-body">
                        <ul class="layui-timeline">
                            <li class="layui-timeline-item">
                                <i class="layui-icon layui-timeline-axis">&#xe63f;</i>
                                <div class="layui-timeline-content layui-text">
                                    <h3 class="layui-timeline-title">v1.0.1</h3>
                                    <p>
                                        新增功能：<br>
                                        1.主页<br>
                                        2.系统日志
                                    </p>
                                </div>
                            </li>
                            <li class="layui-timeline-item">
                                <i class="layui-icon layui-timeline-axis">&#xe63f;</i>
                                <div class="layui-timeline-content layui-text">
                                    <h3 class="layui-timeline-title">v1.0</h3>
                                    <p>
                                        正式发布v1.0系统<br>
                                        1.锁闭保护<br>
                                        2.粘随子系统<br>
                                        3.用户管理
                                    </p>
                                </div>
                            </li>
                            <li class="layui-timeline-item">
                                <i class="layui-icon layui-timeline-axis">&#xe63f;</i>
                                <div class="layui-timeline-content layui-text">
                                    <div class="layui-timeline-title">EchoTeam</div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="layui-col-md5">

        <div class="layui-card">
            <div class="layui-card-header">
                <span class="larger-bold">日志数据</span>
                <span class="layui-card-sub-header">(近6日)</span>
            </div>
            <div class="layui-card-body" style="height: 380px;">
                <div id="lineChart" style="width: 100%; height: 100%;"></div>
            </div>
        </div>
        <div class="layui-card">
            <div class="layui-card-header larger-bold">技术文档</div>
            <table class="layui-table">
                <thead>
                <tr>
                    <th>序号</th>
                    <th>作者</th>
                    <th>内容</th>
                    <th>点击量</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>1</td>
                    <td>顾凡</td>
                    <td>关于工控恶意软件的调研</td>
                    <td>21</td>
                    <td>
                        <a href="https://www.baidu.com"
                           class="open-webpage">查看</a>
                    </td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>顾凡</td>
                    <td>测试大纲</td>
                    <td>11</td>
                    <td>
                        <a href="https://www.baidu.com"
                           class="open-webpage">查看</a>
                    </td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>岳天一</td>
                    <td>ai办公工具分享</td>
                    <td>30</td>
                    <td>
                        <a href="https://gitee.com/mospher/pbft-master-origin/raw/master/ai%E4%B8%8E%E5%8A%9E%E5%85%AC.pptx"
                           class="open-webpage">查看</a>
                    </td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>杨佳庚</td>
                    <td>鉴权蜜融合</td>
                    <td>31</td>
                    <td>
                        <a href="https://www.baidu.com"
                           class="open-webpage">查看</a>
                    </td>
                </tr>
                <tr>
                    <td>5</td>
                    <td>王田</td>
                    <td>atomicals nft</td>
                    <td>111</td>
                    <td>
                        <a href="https://www.baidu.com"
                           class="open-webpage">查看</a>
                    </td>
                </tr>
                <tr>
                    <td>6</td>
                    <td>张云涛</td>
                    <td>ATOM叙事</td>
                    <td>1211</td>
                    <td>
                        <a href="https://www.baidu.com"
                           class="open-webpage">查看</a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<script th:replace="/common/template :: script"></script>
<script type="text/javascript" th:src="@{/js/plugins/echarts.min.js}"></script>
<script type="text/javascript" th:src="@{/js/plugins/jquery-2.2.4.js}"></script>

<!--折线图-->
<script type="text/javascript">
    // 折线图
    var myChart = echarts.init(document.getElementById('lineChart'));
    function getFormattedDate() {
        var date = new Date();
        var year = date.getFullYear();
        var month = ("0" + (date.getMonth() + 1)).slice(-2);
        var day = ("0" + date.getDate()).slice(-2);
        return year + "-" + month + "-" + day;
    }

    const url = '/system/actionLog/dates/' + getFormattedDate();
    // 使用jQuery发起Ajax请求（假设你的后端API返回的数据格式与serverCapacities一致）
    $(document).ready(function() {
        $.ajax({
            url:url,
            method: 'GET',
            success: function(response) {
                console.log('url:', url); // 输出整个
                let serverCapacities = response;
                const dates = Object.keys(serverCapacities);
                // 将对象转换为数组，并按照键（日期）排序
                const sortedEntries = Object.entries(response).sort((a, b) => new Date(a[0]).getTime() - new Date(b[0]).getTime());

                // 获取最后两个条目的日志数量
                const [lastDate, lastCount] = sortedEntries.pop();
                const [penultimateDate, penultimateCount] = sortedEntries.pop();

                // 计算差值
                const diff = lastCount - penultimateCount;

                // 更新DOM元素中的数据
                $('#newLogsCount').text(diff);
                const series = {
                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                        { offset: 0, color: 'rgb(66,111,251)' }, // 开始颜色（例如红色）
                        { offset: 1, color: 'rgb(24,228,253)' }   // 结束颜色（例如绿色）
                    ]),
                    name: 'Server Capacity',
                    type: 'line',
                    smooth: true,
                    symbolSize: 10,
                    emphasis: {
                        focus: 'series',
                        symbolSize: 25,
                    },
                    lineStyle: {
                        width: 4
                    },
                    data: dates.map(date => serverCapacities[date]) // 根据日期获取对应的服务器容量
                };

                // 定义 ECharts 图表配置项
                const option = {
                    tooltip: {
                        trigger: 'axis',
                        formatter: (params) => `
            <div style="font-size: larger;">${params[0].name}</div>
            日志数量: ${params[0].value * 1}
        `,
                        backgroundColor: 'rgb(236,244,251)', // 可选，设置背景颜色以提高可读性
                        padding: [10, 15], // 可选，设置内边距
                        textStyle: { // 可选，设置文字样式
                            color: '#000000',
                            fontSize: 14 // 这里统一设置了tooltip的文字大小，如果你想让日期更大，可以在这里或formatter中第一行单独指定更大的字号
                        },
                    },
                    xAxis: {
                        type: 'category',
                        boundaryGap: false,
                        axisLabel: {
                            margin: 30,
                            fontSize: 16
                        },
                        data: dates
                    },
                    yAxis: {
                        type: 'value',
                        show: true,
                        axisLabel: {
                            margin: 30,
                            fontSize: 16,
                            formatter: '{value} ' // 假设单位是GB
                        },
                        splitNumber: 5, // 这个属性可以根据需求调整纵坐标轴的分割段数，默认为5
                        interval: Math.max.apply(null, series.data) / 5, // 自动计算一个合适的间隔值，这里假设最大值分为5份
                        min: 0 // 根据实际情况设定最小值
                    },
                    series: [series]
                };
                // 使用刚指定的配置项和数据显示图表。
                myChart.setOption(option);
            },
            error: function(err) {
            }
        });
    });
</script>
<!--饼状图-->
<script type="text/javascript">
    // 获取图表容器
    var pieChartDom = echarts.init(document.getElementById('pieChart'));

    // 初始化饼状图实例
    let index = 0;
    var colorList = [
        '#313ca8',
        '#249dfd',
        '#21cafd']
    function fun() {
        var timer = setInterval(function() {
            myChart.dispatchAction({
                type: 'hideTip',
                seriesIndex: 0,
                dataIndex: index
            });
            // 显示提示框
            myChart.dispatchAction({
                type: 'showTip',
                seriesIndex: 0,
                dataIndex: index
            });
            // 取消高亮指定的数据图形
            myChart.dispatchAction({
                type: 'downplay',
                seriesIndex: 0,
                dataIndex: index === 0? 5 : index -1
            });
            myChart.dispatchAction({
                type: 'highlight',
                seriesIndex: 0,
                dataIndex: index
            });
            index++;
            if (index > 5) {
                index = 0;
            }
        },3000)
    }

    fun()
    setTimeout(function() {fun()}, 50000);
    option2 = {
        tooltip: {
            trigger: 'item',
            formatter: (params) => `${params.data.name}: ${params.data.value}MB`,
            backgroundColor: 'rgb(236,244,251)', // 可选，设置背景颜色以提高可读性
            padding: [10, 15], // 可选，设置内边距
            textStyle: { // 可选，设置文字样式
                color: '#000000',
                fontSize: 14 // 这里统一设置了tooltip的文字大小，如果你想让日期更大，可以在这里或formatter中第一行单独指定更大的字号
            },
        },
        series: [{
            type: 'pie',
            center: ['50%', '50%'],
            radius: ['24%', '45%'],
            clockwise: true,
            avoidLabelOverlap: true,
            hoverOffset: 15,
            itemStyle: {
                normal: {
                    color: function(params) {
                        return colorList[params.dataIndex]
                    }
                }
            },
            label: {
                show: true,
                position: 'outside',
                formatter: '{a|{b}：{d}%}\n{hr|}',
                rich: {
                    hr: {
                        backgroundColor: 't',
                        borderRadius: 3,
                        width: 3,
                        height: 3,
                        padding: [3, 3, 0, -12]
                    },
                    a: {
                        padding: [-30, 15, -20, 15]
                    }
                }
            },
            labelLine: {
                normal: {
                    length: 20,
                    length2: 30,
                    lineStyle: {
                        width: 1
                    }
                }
            },
            data: [{
                'name': '锁闭保护',
                'value': 45
            }, {
                'name': '粘随子系统',
                'value': 43
            }, {
                'name': '鉴权子系统',
                'value': 50
            }
            ],
        }]
    };

    // 将配置项应用到图表实例
    pieChartDom.setOption(option2);
</script>
<!--表格-->
</body>
</html>

